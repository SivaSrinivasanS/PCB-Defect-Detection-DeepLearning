<cleaned code omitted for brevity>